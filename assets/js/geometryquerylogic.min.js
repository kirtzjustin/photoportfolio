function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function onlyUnique(e,t,a){return a.indexOf(e)===t}function formatDate(e){let t=["January","February","March","April","May","June","July","August","September","October","November","December"],a=e.getMonth(),r=e.getFullYear();return t[a]+" "+r}function queryLayerViewStats(e){let t=["Google Map","Location","Published","Title","Updated"],a=[],r=0,l=0,o=0,i=0,n=0,s=0,u=0,c=0,d=0,p=0,f=0;try{return app.queryLayerView.queryFeatures({geometry:e,outFields:t,returnGeometry:!0}).then(function(e){for(var t in e.features){let b=JSON.parse(e.features[t].attributes.Location);for(let a in b)e.features[t].attributes[a]=b[a];if(a.push(e.features[t].attributes),e.features[t].attributes.Published){let a=e.features[t].attributes.Published,b=new Date(a),g=formatDate(b);switch(g){case"June 2018":r++;break;case"July 2018":l++;break;case"August 2018":o++;break;case"September 2018":i++;break;case"October 2018":n++;break;case"November 2018":s++;break;case"December 2018":u++;break;case"January 2019":c++;break;case"February 2019":d++;break;case"March 2019":p++;break;case"May 2019":f++}}else console.log("No value found")}totalSelectedFeatures=e.features.length;let b=[r,l,o,i,n,s,u,c,d,p,f];return{updatedDataCount:b,tableData:a,titleCount:"Total: "+totalSelectedFeatures.toString()+" Features"}})}catch(e){console.log("Error Message - Count Chart: ",e.message)}}function updateCharts(e,t){function a(){let e=$("#filter-field").val();app.statsTable.setFilter(e,$("#filter-type").val(),$("#filter-value").val())}function r(e){let t=e.currentTarget.value;app.statsTable.setGroupBy(t)}let l,o=e.updatedDataCount,i=e.titleCount;for(var n in e.tableData){let t=new Date(e.tableData[n].Published),a=new Date(e.tableData[n].Updated);e.tableData[n].Published=(t.getMonth()+1).toString()+"/"+t.getDate().toString()+"/"+t.getFullYear().toString(),e.tableData[n].Updated=(a.getMonth()+1).toString()+"/"+a.getDate().toString()+"/"+a.getFullYear().toString()}if(l=e.tableData,app.chartCount)app.chartCount.options.title.text=i,app.chartCount.data.datasets[0].data=o,app.chartCount.update();else{let e=document.getElementById(t);app.chartCount=new Chart(e.getContext("2d"),{type:"pie",data:{labels:["June 2018","July 2018","August 2018","September 2018","October 2018","November 2018","December 2018","January 2019","February 2019","March 2019","May 2019"],datasets:[{label:"My Travel Locations",datalabels:{color:"black",align:"center",clamp:!0,font:{size:10,family:"'Quicksand', 'Arial', sans-serif"}},backgroundColor:["rgb(255, 255, 120)","rgb(255, 180, 120)","rgb(80, 255, 120)","rgb(190, 180, 235)","rgb(255, 140, 0)","rgb(54,171,51)","rgb(190, 26, 235)","rgb(178, 178, 178)","rgb(45,211,21)","rgb(77,22,222)","rgb(90,0,175)"],borderColor:["rgb(255, 255, 255)"],borderWidth:1,data:o}]},options:{responsive:!0,maintainAspectRatio:!1,legend:{position:"bottom",labels:{fontColor:"rgb(23, 43, 94)",fontFamily:"'Quicksand', 'Arial', sans-serif"},onHover:function(e){e.target.style.cursor="pointer"}},title:{display:!0,text:i,fontColor:"rgb(0, 138, 80)",fontFamily:"'Quicksand', 'Arial', sans-serif"},animation:{easing:"easeOutBounce",duration:1250,onComplete:function(){app.chartCount.options.animation.easing="easeOutCubic",app.chartCount.options.animation.duration=1e3,app.queryingIndicatorContainer.classList.add("noVisibility")}},tooltips:{callbacks:{label:(e,t)=>{let a=e.index,r=t.datasets[0].data[a];return[r+" Features"]},afterLabel:(e,t)=>{let a=t.datasets[e.datasetIndex],r=a.data.reduce((e,t)=>e+t),l=a.data[e.index],o=Math.round(l/r*100);return o+"% Of Total Selected Features"},title:(e,t)=>{let a=e[0].index,r=t.labels[a];return r}}}}})}var s=()=>'<span class="esri-icon esri-icon-zoom-in-magnifying-glass" aria-hidden="true" title="Zoom To Feature"></span>';$("#filter-field, #filter-type").change(a),$("#filter-value").keyup(a),$("#groupByFilter").change(r),$("#filterClear").click(function(){$("#filter-field").val(""),$("#filter-type").val("like"),$("#filter-value").val(""),$("#groupByFilter").val(""),app.statsTable.clearFilter()}),app.statsTable=new Tabulator("#jhkTable",{data:l,height:450,layout:"fitDataFill",selectable:1,placeholder:"No Features Available In Specified Area",pagination:"local",paginationSize:20,groupBy:"",groupClosedShowCalcs:!0,columnCalcs:"both",downloadConfig:{columnGroups:!0,rowGroups:!0,columnCalcs:!0},paginationSizeSelector:[10,20,30,40,50,60,70,80,90,100],rowClick:function(e,t){app.activeView.whenLayerView(app.queryLayer).then(function(e){let a=app.queryLayer.createQuery();a.where="Title = '"+t._row.data.Title+"'",a.outSpatialReference=app.activeView.spatialReference,a.returnGeometry=!0,app.queryLayer.queryFeatures(a).then(function(e){let t=e.features[0];app.activeView.goTo({target:t.geometry,zoom:20}),app.activeView.popup.open({location:t.geometry,features:e.features})})})},rowMouseOver:function(e,t){app.activeView.whenLayerView(app.queryLayer).then(function(e){let a=app.queryLayer.createQuery();a.where="Title = '"+t._row.data.Title+"'",a.outSpatialReference=app.activeView.spatialReference,a.returnGeometry=!0,e.queryFeatures(a).then(function(e){let t=e.features[0];app.activeView.graphics.removeAll(),app.selectedTableFeature.geometry=t.geometry,app.activeView.graphics.add(app.selectedTableFeature)})})},rowMouseLeave:function(e,t){app.activeView.graphics.removeAll()},initialSort:[{column:"Title",dir:"asc"}],columns:[{title:"Zoom",align:"center",formatter:s,headerSort:!1,download:!1,frozen:!0},{title:"Title",field:"Title",sorter:"string",frozen:!0,download:!1,topCalc:"count",headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Business Name",field:"Business Name",sorter:"string",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Address",field:"Address",sorter:"string",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Country Code",field:"Country Code",sorter:"string",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Google Map",field:"Google_Map",sorter:"string",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Published",field:"Published",sorter:"string",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Updated",field:"Updated",sorter:"string",headerFilter:!0,frozen:!1,headerFilterPlaceholder:"Filter Column"}]});var u=document.getElementById("downloadXlsx"),c=document.getElementById("downloadCsv");u.onclick=function(){app.statsTable.download("xlsx","data.xlsx",{sheetName:"My Data"})},c.onclick=function(){app.statsTable.download("csv","data.csv")}}