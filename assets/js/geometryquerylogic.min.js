function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function onlyUnique(e,t,a){return a.indexOf(e)===t}function formatDate(e){e.getMonth();return e.getFullYear().toString()}function queryLayerViewStats(e){let t=["google_map","location","date","Comment","FID"],a=[],r=0,l=0,o=0,i=0,n=0,s=0,u=0,d=0;try{return app.queryLayerView.queryFeatures({geometry:e,outFields:t,returnGeometry:!0}).then((function(e){for(var t in e.features){let c=JSON.parse(e.features[t].attributes.location);for(let a in c)e.features[t].attributes[a]=c[a];if(a.push(e.features[t].attributes),e.features[t].attributes.date){let a=e.features[t].attributes.date;switch(formatDate(new Date(a))){case"2018":r++;break;case"2019":l++;break;case"2020":o++;break;case"2021":i++;break;case"2022":n++;break;case"2023":s++;break;case"2024":u++;break;case"2025":d++;break}}}return totalSelectedFeatures=e.features.length,{updatedDataCount:[r,l,o,i,n,s,u,d],tableData:a,titleCount:"Total: "+totalSelectedFeatures.toString()+" Features"}}))}catch(e){}}function updateCharts(e,t){let a,r=e.updatedDataCount,l=e.titleCount;for(var o in e.tableData){let t=new Date(e.tableData[o].date);e.tableData[o].date=(t.getMonth()+1).toString()+"/"+t.getDate().toString()+"/"+t.getFullYear().toString()}if(a=e.tableData,app.chartCount)app.chartCount.options.title.text=l,app.chartCount.data.datasets[0].data=r,app.chartCount.update();else{let e=document.getElementById(t);app.chartCount=new Chart(e.getContext("2d"),{type:"line",data:{labels:["2018","2019","2020","2021","2022","2023","2024","2025"],datasets:[{label:"My Travel Locations",datalabels:{color:"black",align:"end",clamp:!0,font:{size:10,family:"'Quicksand', 'Arial', sans-serif"}},borderColor:["rgb(255, 36, 36)"],borderWidth:3,pointStyle:"rectRot",pointRadius:5,pointBorderColor:"rgb(0, 0, 0)",pointBorderWidth:2,data:r}]},options:{responsive:!0,maintainAspectRatio:!1,legend:{position:"bottom",labels:{fontColor:"rgb(23, 43, 94)",fontFamily:"'Quicksand', 'Arial', sans-serif"},onHover:function(e){e.target.style.cursor="pointer"}},title:{display:!0,text:l,fontColor:"rgb(0, 138, 80)",fontFamily:"'Quicksand', 'Arial', sans-serif"},animation:{easing:"easeOutBounce",duration:1250,onComplete:function(){app.chartCount.options.animation.easing="easeOutCubic",app.chartCount.options.animation.duration=1e3,app.queryingIndicatorContainer.classList.add("noVisibility")}},tooltips:{callbacks:{label:(e,t)=>{let a=e.index;return[t.datasets[0].data[a]+" Features"]},afterLabel:(e,t)=>{let a=t.datasets[e.datasetIndex],r=a.data.reduce(((e,t)=>e+t)),l=a.data[e.index];return Math.round(l/r*100)+"% Of Total Selected Features"},title:(e,t)=>{let a=e[0].index;return t.labels[a]}}},scales:{xAxes:[{display:!0,ticks:{major:{enabled:!0}}}],yAxes:[{id:"y",display:!0}]}}})}function i(){let e=$("#filter-field").val();app.statsTable.setFilter(e,$("#filter-type").val(),$("#filter-value").val())}$("#filter-field, #filter-type").change(i),$("#filter-value").keyup(i),$("#groupByFilter").change((function(e){let t=e.currentTarget.value;app.statsTable.setGroupBy(t)})),$("#filterClear").click((function(){$("#filter-field").val(""),$("#filter-type").val("like"),$("#filter-value").val(""),$("#groupByFilter").val(""),app.statsTable.clearFilter()})),app.statsTable=new Tabulator("#jhkTable",{data:a,height:450,layout:"fitDataFill",selectable:1,placeholder:"No Features Available In Specified Area",pagination:"local",paginationSize:20,groupBy:"",groupClosedShowCalcs:!0,columnCalcs:"both",downloadConfig:{columnGroups:!0,rowGroups:!0,columnCalcs:!0},paginationSizeSelector:[10,20,30,40,50,60,70,80,90,100],rowClick:function(e,t){app.activeView.whenLayerView(app.queryLayer).then((function(e){let a=app.queryLayer.createQuery();a.where="FID = '"+t._row.data.FID+"'",a.outSpatialReference=app.activeView.spatialReference,a.returnGeometry=!0,app.queryLayer.queryFeatures(a).then((function(e){try{let t=e.features[0];app.activeView.goTo({target:t.geometry,zoom:20})}catch(e){}}))}))},rowMouseOver:function(e,t){app.activeView.whenLayerView(app.queryLayer).then((function(e){let a=app.queryLayer.createQuery();a.where="FID = '"+t._row.data.FID+"'",a.outSpatialReference=app.activeView.spatialReference,a.returnGeometry=!0,e.queryFeatures(a).then((function(e){try{let t=e.features[0];app.activeView.graphics.removeAll(),app.selectedTableFeature.geometry=t.geometry,app.activeView.graphics.add(app.selectedTableFeature)}catch(e){}}))}))},rowMouseLeave:function(e,t){app.activeView.graphics.removeAll()},initialSort:[{column:"name",dir:"asc"}],columns:[{title:"Zoom",align:"center",formatter:()=>'<span class="esri-icon esri-icon-zoom-in-magnifying-glass" aria-hidden="true" title="Zoom To Feature"></span>',headerSort:!1,download:!1,frozen:!0},{title:"Business Name",field:"name",sorter:"string",frozen:!0,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Address",field:"address",sorter:"string",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Country Code",field:"country_code",sorter:"string",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Google Map",field:"google_map",sorter:"string",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"},{title:"Date Added",field:"date",sorter:"date",frozen:!1,headerFilter:!0,headerFilterPlaceholder:"Filter Column"}]});var n=document.getElementById("downloadXlsx"),s=document.getElementById("downloadCsv");n.onclick=function(){app.statsTable.download("xlsx","data.xlsx",{sheetName:"My Data"})},s.onclick=function(){app.statsTable.download("csv","data.csv")}}